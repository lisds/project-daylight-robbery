# Seasonal Changes

Coming into this project one of the questions we had was what affect daylight, and seasonality has on crime in London. We are particularly interested in certain crimes where individuals may perceive higher risk during hours of darkness such as rape and other violent offences.

We do not have data on the time at which crimes took place which limits our ability to investigate the affect of daylight vs darkness on the number of crimes. However, British Summer Time (BST) creates a change in daylight hours which we will use to look at a seasonal differences in the number of crimes.

```{python}
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from projtools.data import Data

data = Data()
idx = pd.IndexSlice
rng = np.random.default_rng()
```

[BST starts on the last Sunday of March and ends on the last Sunday of October](https://en.wikipedia.org/wiki/British_Summer_Time). For our purposes we will consider April - October summer and November - March winter.

```{python}
summer_months = ["04","05","06","07","08","09","10"]
winter_months = ["01","02","03","11","12"]
```

```{python}
summer = (data.borough
              .loc[:, idx[:, summer_months]])
winter = (data.borough
              .loc[:, idx[:, winter_months]])
```

```{python}
winter
```

```{python}
summer_rape = (summer.loc[idx[:,"Rape"], :]
                     .sum()
                     .T
                     .groupby(level="month")
                     .sum()
                     .sort_values(ascending=False))
summer_rape
```

```{python}
winter_rape = (winter.loc[idx[:,"Rape"], :]
                     .sum()
                     .T
                     .groupby(level="month")
                     .sum()
                     .sort_values(ascending=False))
winter_rape
```

```{python}
print("Summer month average: " + str(summer_rape.sum() / len(summer_months)))
print("Winter month average: " + str(winter_rape.sum() / len(winter_months)))
```

Next steps, run a permutation test - shuffle the number of crimes between months and see how surprising the average month diff is...

```{python}
summer_mean = summer_rape.sum() / len(summer_months)
winter_mean = winter_rape.sum() / len(winter_months)
observed_difference = summer_mean - winter_mean
observed_difference
```

```{python}
iterations = 10_000
fake_differences = np.zeros(iterations)
pooled = np.concatenate([summer_rape, winter_rape])

for index in np.arange(iterations):
    shuffled = rng.permutation(pooled)
    
    fake_summer_mean = np.mean(shuffled[:len(summer_months)])
    fake_winter_mean = np.mean(shuffled[len(summer_months):])
    
    fake_diff = fake_summer_mean - fake_winter_mean
    
    fake_differences[index] = fake_diff
    
plt.hist(fake_differences)
```

```{python}
number_geater_actual = np.count_nonzero(fake_differences >= observed_difference)
nnumber_geater_actual
```

```{python}
proportion_geater_actual = n_ge_actual / 10000
proportion_geater_actual
```
