# Sankey Diagrams
I initially wanted to make a collection of sankey diagrams to show offences broken down by the boroughs in which they were recorded.

This would provide a visual and easy way of seeing if there are any interesting trends in the way the crimes are created across London.

```{python}
# %matplotlib inline
import matplotlib.pyplot as plt
#import plotly.express as px
import matplotlib.sankey as Sankey
import numpy as np
import pandas as pd
from projtools.data import Data

data = Data()

#sankey diagrams of an offence broken down by borough
```

```{python}
sankey_v = data.borough.T.groupby(level='year').sum().sum()
sankey_df = pd.DataFrame(sankey_v, columns=['count'])
sankey_df = sankey_df.groupby(['category','borough']).sum()
```

```{python}
sankey_df
```

```{python}

```

The dataframe above groups all offences by the borough in which they were committed and the category they belong to.

This makes it easy to split the data by category and plot all the boroughs within it.


#### Arson and Criminal Damage Example

```{python}
pos_values = list(sankey_df.loc['Arson and Criminal Damage', :]['count'].values)
keys = list(sankey_df.loc['Arson and Criminal Damage', :]['count'].keys())
neg_values = [-x for x in pos_values]
```

##### This iteration did not go so well

```{python}
fig = plt.figure(figsize=(10, 15))
ax = fig.add_subplot()

sankey = Sankey.Sankey(ax=ax, scale=0.0015, offset=0.3)
sankey.add(flows=[(10928170)],
           labels=['Total ACD Offences'],
          pathlengths=10).add(flows=neg_values,
           labels=keys,
           orientations=-1,
           pathlengths=100).finish()


plt.title('Sankey Diagram')
plt.show()
```

##### This iteration was slightly better, but still not completely legible

```{python}
fig = plt.figure(figsize=(10, 10))
ax = fig.add_subplot()

sankey1 = Sankey.Sankey(ax=ax)
sankey1.add(flows=[(100)],
           labels=['Total ACD Offences']).add(flows=neg_values, orientations=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
           labels=keys).finish()
# plt.xticks(keys, rotation='vertical')
# for d in diagrams:
#     for t in d.texts:
#         t.set_verticalalignment('center')
# ax.text(0, 0, keys, rotation=90)
sankey1
```

### Change in tact

```{python}
def percentages(category):
    values = list(sankey_df.loc[category, :]['count'])
    keys = list(sankey_df.loc[category, :]['count'].keys())
    for i in values:
        percents = np.array((i / sum(values)) * 100)
    return values#pd.DataFrame(percents, keys)
```

```{python}
percentages('Arson and Criminal Damage')
```
